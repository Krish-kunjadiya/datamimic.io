{% extends "base.html" %}

{% block title %}Generator{% endblock %}

{% block head_scripts %}
    <!-- No client-side plotting libraries needed here -->
{% endblock %}

{% block content %}
<div class="container">
    <div class="generator-page">
    {# The original .error div is now managed by Flask's flash messages in base.html #}
    
    <div class="form-group">
        <label for="schemaSelect">Select Schema</label>
        <select id="schemaSelect">
            <option value="" disabled selected>Choose data type</option>
            <option value="medical">Medical</option>
            <option value="finance">Finance</option>
            <option value="retail">Retail</option>
            <option value="education">Education</option>
            <option value="automotive">Automotive</option>
        </select>
    </div>

    <div class="form-group">
        <label for="localitySelect">Select Locality</label>
        <select id="localitySelect">
            <option value="" disabled selected>Choose locality</option>
            <option value="India">India</option>
            <option value="US">United States</option>
            <option value="UK">United Kingdom</option>
            <option value="Canada">Canada</option>
            <option value="Australia">Australia</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="numRecords">Number of Records</label>
        <input type="number" id="numRecords" min="1" max="100000" value="100">
        <p class="help-text">Number of rows for the generated dataset (max 100,000).</p>
    </div>
    
    <div class="form-group">
        <label for="missingRatio">Missing Values Ratio (%)</label>
        <input type="range" id="missingRatio" min="0" max="100" value="5" class="slider">
        <span id="missingRatioValue">5%</span>
        <p class="help-text">Controls the approximate percentage of missing values to be randomly introduced.</p>
    </div>
    
    <div class="form-group">
        <label for="varianceRatio">Data Variance Ratio (%)</label>
        <input type="range" id="varianceRatio" min="0" max="100" value="50" class="slider">
        <span id="varianceRatioValue">50%</span>
        <p class="help-text">Influences the spread/diversity of numerical values. Higher means more variation.</p>
    </div>
    
    <div class="form-group">
        <label>Select Pre-defined Columns</label>
        <div class="select-all-container">
            <label class="column-checkbox">
                <input type="checkbox" id="selectAll">
                Select All
            </label>
        </div>
        <div class="column-select" id="columnSelect"></div>
        <p class="help-text mt-2">Choose which columns to include from the selected schema.</p>
    </div>

    {# --- NEW: AI-POWERED CUSTOM COLUMN DEFINITION SECTION --- #}
    <div class="form-group">
        <h3><i class="fas fa-robot"></i> AI-Powered Custom Columns</h3>
        <p class="help-text">Define custom columns whose values will be generated by AI based on your prompts. These will be added to your generated dataset.</p>
        
        <div class="mb-3">
            <label for="ai_custom_col_name" class="form-label">Custom Column Name:</label>
            <input type="text" id="ai_custom_col_name" class="form-control" placeholder="e.g., Customer_Feedback" required>
        </div>
        
        <div class="mb-3">
            <label for="ai_custom_col_type" class="form-label">Custom Column Type:</label>
            <select id="ai_custom_col_type" class="form-select" required>
                <option value="">-- Select Type --</option>
                <option value="String">String</option>
                <option value="Categorical">Categorical</option>
                <option value="Integer">Integer</option>
                <option value="Float">Float</option>
                <option value="Boolean">Boolean</option>
                <option value="Date">Date (YYYY-MM-DD)</option>
            </select>
        </div>
        
        <div class="mb-3">
            <label for="ai_custom_col_prompt" class="form-label">AI Generation Prompt/Description:</label>
            <textarea id="ai_custom_col_prompt" class="form-control" rows="3" placeholder="e.g., 'Positive or negative customer sentiments', 'List of programming languages', 'Product ratings from 1 to 5'" required></textarea>
            <p class="help-text">This prompt will guide the AI in generating values for this column.</p>
        </div>
        
        <button type="button" class="generate-btn small-btn mt-2" id="add_ai_custom_column_btn">
            <i class="fas fa-plus"></i> Add AI Custom Column
        </button>

        <h4 class="mt-4">Added AI Custom Columns:</h4>
        <ul class="list-group" id="ai_custom_columns_list">
            <!-- AI custom columns will be dynamically added here by JS -->
        </ul>
    </div>
    {# --- END NEW AI-POWERED CUSTOM COLUMN DEFINITION SECTION --- #}


    <button id="generateBtn" class="generate-btn">
        <i class="fas fa-sync-alt"></i> Generate Synthetic Data
    </button>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Generating data...</p>
    </div>
    
    <div class="results" id="results">
        <div class="results-header">
            <h2>Generated Data</h2>
            <div class="download-btns">
                <button class="download-btn csv-btn" id="downloadCsvBtn">
                    <i class="fas fa-file-csv"></i> Download CSV
                </button>
                <button class="download-btn json-btn" id="downloadJsonBtn">
                    <i class="fas fa-file-code"></i> Download JSON
                </button>
                <button class="download-btn excel-btn" id="downloadExcelBtn">
                    <i class="fas fa-file-excel"></i> Download Excel
                </button>
            </div>
        </div>
        
        <div class="data-stats" id="dataStats">
            <h3>Data Statistics</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Total Records:</span>
                    <span class="stat-value" id="totalRecords">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Missing Values:</span>
                    <span class="stat-value" id="missingValues">0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Data Variance:</span>
                    <span class="stat-value" id="dataVariance">0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">File Size:</span>
                    <span class="stat-value" id="fileSize">0 KB</span>
                </div>
            </div>
            <div class="column-stats" id="columnStats">
                <!-- Column-specific stats will be added here dynamically -->
            </div>
        </div>
        
        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr id="tableHeader"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/generator.js') }}"></script>
    <script>
        // No custom column addition/removal logic for frontend only anymore, it's all handled by AI custom column logic
        // This script block is effectively empty now, as its previous content moved to generator.js
    </script>
{% endblock %}